function getUrlQueryStringData(a){var b=null;var c="[\\?&#]"+a+"=([^&#]*)";var d=new RegExp(c);var e=d.exec('?'+window.location.href.split('?')[1]);if(e!=null){b=decodeURIComponent(e[1].replace(/\+/g," "))}return b};function getVarQueryStringData(a,b){var c=null;var d="[\\?&#]"+a+"=([^&#]*)";var e=new RegExp(d);var f=e.exec('?'+b.split('?')[1]);if(f!=null){c=decodeURIComponent(f[1].replace(/\+/g," "))}return c};$(document).on('pageshow','div[id="articles"]',function(e,f){var g=getUrlQueryStringData("url"),categoryQuery=getUrlQueryStringData("category"),categoryURL="";if(categoryQuery){categoryURL='http://1688.com.au/site1/news/'+categoryQuery+'/index.shtml'}else if(g){categoryURL=g.replace(/.*site1\/news/,"http://1688.com.au/site1/news")}$.get(categoryURL,function(c){var d=$('div[id="articles"]'),$header=d.children(":jqmData(role=header)"),$content=d.children(":jqmData(role=content)"),$footer=d.children(":jqmData(role=footer)"),markup="<ul data-role='listview' data-theme='c' data-dividertheme='a' data-inset='false'>",articlelist="";navlist="",navheader="";$("div[class=listing_head]:first",c.responseText).each(function(){var a=$(this),headingName=a.text();if(headingName){$header.find("h1").html($.trim(headingName))}});$("div[class=list_nav]:first a[href]",c.responseText).each(function(){var a=$(this),navitemurl=a.attr('href');if(navitemurl){navlist+="<li><a href='articles.htm?url="+encodeURIComponent(navitemurl)+"'>";navlist+=a.text()+"</a></li>"}});$("div[class=list_nav]:first",c.responseText).each(function(){var a=$(this),navtext=a.text();if(navtext){var b=$.trim(navtext.split("【")[1]);if(b){navheader+="<li data-role='list-divider' style='text-align:center' role='heading'>";navheader+=b+"</li>"}}});$("div[class=content_list]:first li",c.responseText).each(function(){var a=$(this),newsitemurl=$("a",a).attr('href');if(newsitemurl){if(categoryURL.indexOf(newsitemurl)==-1){articlelist+="<li>";articlelist+="<a href='view.htm?url="+encodeURIComponent(newsitemurl)+"'>";articlelist+="<p>"+$("a",a).text()+"</p>";articlelist+="<p>"+$("span",a).text()+"</p>";articlelist+="</a>";articlelist+="</li>"}}});markup+=navheader;markup+=articlelist;if(articlelist!=""){markup+=navheader}markup+="</ul>";if(navlist!=""){$footer.html("<div data-role='navbar'><ul>"+navlist+"</ul></div>")}$content.html(markup);d.page();$footer.find(":jqmData(role=navbar)").navbar();$content.find(":jqmData(role=listview)").listview()})});$(document).on('pageshow','div[id="view"]',function(e,f){var g=getUrlQueryStringData("url"),newsURL=((g)?g.replace(/.*site1\/news/,"http://1688.com.au/site1/news"):"");$.get(newsURL,function(c){var d=$('div[id="view"]'),$header=d.children(":jqmData(role=header)"),$content=d.children(":jqmData(role=content)"),markup="<div id='turbocmscontent'>",list="";$("div[id=tit]:first, td[class=content1_3]:first",c.responseText).each(function(){var a=$(this).text();if(a){$header.find("h1").html($.trim(a))}});$("td[id=content]:first",c.responseText).each(function(){var a=$(this).html(),newscontent=a.substring(a.indexOf('<!--turbocmscontentbegin-->')+27,a.indexOf('<!--turbocmscontentend-->'));markup+=newscontent});$("div[id=content]:first",c.responseText).each(function(){$(this).find('div').first().remove();$(this).find('div[id=social_share]').first().remove();$(this).find('div[id=pages_nav]').first().remove();var a=$(this).html();markup+=a});markup+="</div><br /><br />";$('div[class=rel] ul li a[href], td[class=content1_6] ul li a[href]',c.responseText).each(function(){var a=$(this),relatednewsitemurl=a.attr('href');if(relatednewsitemurl){if(newsURL.indexOf(relatednewsitemurl)==-1){list+="<li>";list+="<a href='view.htm?url="+encodeURIComponent(relatednewsitemurl)+"'>";list+=a.text();list+="</a>";list+="</li>"}}});markup+="<ul data-role='listview' data-theme='c' data-dividertheme='a' data-inset='false'>";if(list!=""){markup+="<li data-role='list-divider' role='heading'>相关文章</li>";markup+=list}markup+="</ul>";$content.html(markup);$('#turbocmscontent img').css({'max-width':'80%','height':'auto'});$('#turbocmscontent img[src]').attr('src',function(a,b){if(b.indexOf('//')==-1){if(b.substring(0,1)=='/'){return'http://1688.com.au'+b}return newsURL.substring(0,newsURL.lastIndexOf('/')+1)+b}return b});$('#turbocmscontent a[href]').attr('href',function(a,b){if(b.substring(0,12)=='/site1/news/'||b.substring(0,11)=='site1/news/'||b.indexOf('1688.com.au/site1/news/')!=-1){if(newsURL.indexOf(b)==-1){return"view.htm?url="+encodeURIComponent(b)}return"#"}if(b.indexOf('//')==-1&&b.substring(0,1)!='#'){if(b.substring(0,1)=='/'){return'http://1688.com.au'+b}return newsURL.substring(0,newsURL.lastIndexOf('/')+1)+b}return b});$('#turbocmscontent a[href^="view.htm"]').removeAttr('target');$('#turbocmscontent link[href]').attr('href',function(a,b){if(b.indexOf('//')==-1){if(b.substring(0,1)=='/'){return'http://1688.com.au'+b}return newsURL.substring(0,newsURL.lastIndexOf('/')+1)+b}return b});$('#turbocmscontent script[src]').attr('src',function(a,b){if(b.indexOf('//')==-1){if(b.substring(0,1)=='/'){return'http://1688.com.au'+b}return newsURL.substring(0,newsURL.lastIndexOf('/')+1)+b}return b});d.page();$content.find(":jqmData(role=listview)").listview()})});
